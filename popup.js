var getPageURL = function(url) {
    var urlInfo = new URL(url);
    var path = urlInfo.pathname;

    if (path === '') {
        path = '/';
    } else if (path.slice(-1) !== '/') {
        var lastSlash = path.lastIndexOf('/');
        path = path.substr(0, lastSlash + 1);
    }

    return urlInfo.protocol + '://' + urlInfo.hostname + path + '.git/';
};

var getHomeURL = function(url) {
    var urlInfo = new URL(url);
    return urlInfo.protocol + '://' + urlInfo.hostname + '/.git/';
};

var found = function(callbackId) {
    $('#' + callbackId).text('found!');
};

var notFound = function(callbackId) {
    $('#' + callbackId).text('not found :)');
};

var scanUrl = function(url, callbackId) {
    $.getJSON(url).always(function(data, textStatus, jqXHR) {

    });
};

var init = function(url) {
    var pageUrl = getPageURL(url);
    var homeUrl = getHomeURL(url);

    $('#url-home').text(homeUrl);
    $('#url-page').text(pageUrl);

    var checkPageUrl = homeUrl !== pageUrl;

    scanUrl(homeUrl, 'url-home');
    if (checkPageUrl) {
        $('#row-url-page').show();
        scanUrl(pageUrl, 'url-page');
    } else {
        $('#row-url-page').hide();
    }
};

document.addEventListener('DOMContentLoaded', function() {
    chrome.tabs.getSelected(null, function(tab) {
        init(tab.url);
    });
}, false);